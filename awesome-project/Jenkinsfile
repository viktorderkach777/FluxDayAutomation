node {
	properties(
                 [parameters(
                            [string(defaultValue: 'Login', name: 'TestCategory', description: 'Enter the testcategory')]
                            )
                  ]
                  ) 
	
    stage('Check pull request target') {
	    if (changeRequest()) {
            
                    if (env.CHANGE_TARGET == 'master') {
                        throw "This pull request targets the wrong branch. Please reopen the pull request targetting the dev branch."
                    }
                }
    }

    stage 'Checkout'
		checkout scm
	
    stage('Test') {
        if (env.BRANCH_NAME == 'master') {
            echo 'I only execute on the master branch'
            sh 'ls -la'
		dir("awesome-project") {
               sh "ls -la"
               sh "pwd"
               sh 'dotnet --info'
               sh 'dotnet restore'
	       sh 'dotnet test'
             }
        } else {
            echo 'I execute elsewhere'
             sh 'ls -la'
             dir("awesome-project") {
               sh "ls -la"
               sh "pwd"
               sh 'dotnet --info'
               sh 'dotnet restore'
	       sh "dotnet test --filter TestCategory=${params.TestCategory}"
             }
	}
    }
}
